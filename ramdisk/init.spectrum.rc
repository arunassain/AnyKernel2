# SPECTRUM KERNEL MANAGER
# Ramdisk file for profile based kernel management
# Implimentation inspired by Franco's fku profiles

on init
    write /sys/block/zram0/comp_algorithm lz4
    write /sys/block/zram0/max_comp_streams 4
    write /sys/block/zram0/disksize 1073741824

on post-fs-data
    # Enable Spectrum support
    setprop spectrum.support 1

# Boot time fs tune
   write /sys/block/mmcblk0/queue/scheduler cfq
   write /sys/block/mmcblk1/queue/scheduler cfq
   write /sys/block/mmcblk0/queue/iostats 0
   write /sys/block/mmcblk1/queue/iostats 0
   write /sys/block/mmcblk0/queue/iosched/slice_idle 0
   write /sys/block/mmcblk1/queue/iosched/slice_idle 0
   write /sys/block/mmcblk0/queue/read_ahead_kb 2048
   write /sys/block/mmcblk1/queue/read_ahead_kb 2048
   write /sys/block/mmcblk0/queue/nr_requests 256
   write /sys/block/mmcblk1/queue/nr_requests 256
   write /sys/block/mmcblk0/queue/add_random 0
   write /sys/block/mmcblk1/queue/add_random 0

on property:sys.boot_completed=1
    # Set default profile on first boot
    exec u:r:init:s0 root root -- /init.spectrum.sh
    exec u:r:su:s0 root root -- /init.spectrum.sh


    write /proc/sys/vm/swappiness 100
    write /sys/module/lowmemorykiller/parameters/minfree "18432,23040,27648,32256,36864,46080"
    write /proc/sys/net/ipv4/tcp_congestion_control cubic

# Balance (default profile)
on property:persist.spectrum.profile=0
    # Configure governor settings for big cluster
    write /sys/devices/system/cpu/cpu0/online 1
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 998400
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1344000

    # Configure governor settings for little cluster
    write /sys/devices/system/cpu/cpu0/online 1
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "ondemand"
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 902400
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400
    write /sys/module/cpu_input_boost/parameters/input_boost_duration 64
    write /sys/module/cpu_input_boost/parameters/input_boost_freq_lp 902400
    write /sys/module/cpu_input_boost/parameters/input_boost_freq_hp 1209000

    # GPU
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 400000000
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor simple_ondemand

    # Storage
    write /sys/block/mmcblk0/queue/scheduler cfq
    write /sys/block/mmcblk0/queue/read_ahead_kb 2048
    write /sys/block/mmcblk1/queue/scheduler cfq
    write /sys/block/mmcblk1/queue/read_ahead_kb 2048

    # Misc
    chmod 0664 /sys/module/workqueue/parameters/power_efficient
    write /sys/module/workqueue/parameters/power_efficient Y

    # Fsync
    write /sys/module/sync/parameters/fsync_enabled N

    # I/O Statics
    write /sys/block/mmcblk0/queue/iostats 0
    write /sys/block/mmcblk0rpmb/queue/iostats "0"
    write /sys/block/mmcblk0/queue/add_random 0
    write /sys/block/mmcblk1/queue/add_random 0

# Performance
on property:persist.spectrum.profile=1
    # Configure governor settings for big cluster
    write /sys/devices/system/cpu/cpu0/online 1
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "performance"
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401000

    # Configure governor settings for little cluster
    write /sys/devices/system/cpu/cpu4/online 1
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "performance"
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 902400
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400

    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 450000000
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor performance
    write /sys/module/cpu_input_boost/parameters/input_boost_duration 128
    write /sys/module/cpu_input_boost/parameters/input_boost_freq_lp 109400
    write /sys/module/cpu_input_boost/parameters/input_boost_freq_hp 1401000

# Gaming
on property:persist.spectrum.profile=3
    # Configure governor settings for big cluster
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "interactive"
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/above_hispeed_delay 19000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/go_hispeed_load 85
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_rate 20000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq 960000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/io_is_busy 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/target_loads "1 960000:25 1094400:40 1209600:55 1248000:70 1344000:85 1401000:100"
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/min_sample_time 40000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1401000

    # Configure governor settings for little cluster
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "interactive"
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/above_hispeed_delay 39000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/go_hispeed_load 85
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_rate 40000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/hispeed_freq 902400
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/io_is_busy 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/target_loads "1 768000:40 902400:55 998400:70 1094400:85"
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/min_sample_time 40000
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 768000
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 1094400

    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 450000000
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor msm-adreno-tz

    # Storage
    write /sys/block/mmcblk0/queue/scheduler bfq
    write /sys/block/mmcblk0/queue/read_ahead_kb 2048
    write /sys/block/mmcblk1/queue/scheduler bfq
    write /sys/block/mmcblk1/queue/read_ahead_kb 2048

# Battery
on property:persist.spectrum.profile=2
    # Configure governor settings for big cluster
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "interactive"
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 960000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 1248000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/min_sample_time 60000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/go_hispeed_load 98
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/above_hispeed_delay 60000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_rate 30000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/timer_slack 80000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/target_loads 90 1248000:99
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/hispeed_freq 960000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/boost 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/boostpulse_duration 80000
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/fast_ramp_down 1
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/powersave_bias 1
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/screen_off_maxfreq 1094400
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/align_windows 0
    write /sys/devices/system/cpu/cpu0/cpufreq/interactive/max_freq_hysteresis 0

    # Configure governor settings for little cluster
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor "interactive"
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq 768000
    write /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq 998400
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/min_sample_time 55000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/go_hispeed_load 99
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/above_hispeed_delay 55000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_rate 30000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/timer_slack 80000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/hispeed_freq 902400
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/boost 0
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/align_windows 1
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/max_freq_hysteresis 80000
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/fast_ramp_down 1
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/powersave_bias 1
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/screen_off_maxfreq 902400
    write /sys/devices/system/cpu/cpu4/cpufreq/interactive/target_loads 90 998400:99

    # GPU
    write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 300000000
    write /sys/class/kgsl/kgsl-3d0/devfreq/governor powersave

    # Storage
    write /sys/block/mmcblk0/queue/scheduler anxiety
    write /sys/block/mmcblk0/queue/read_ahead_kb 1024
    write /sys/block/mmcblk1/queue/scheduler anxiety
    write /sys/block/mmcblk1/queue/read_ahead_kb 1024

    # Misc
    chmod 0664 /sys/module/workqueue/parameters/power_efficient
    write /sys/module/workqueue/parameters/power_efficient Y

    # Fsync
    write /sys/module/sync/parameters/fsync_enabled N

    # I/O Statics
    write /sys/block/mmcblk0/queue/iostats 0
    write /sys/block/mmcblk0rpmb/queue/iostats "0"
    write /sys/block/mmcblk0/queue/add_random 0
    write /sys/block/mmcblk1/queue/add_random 0
